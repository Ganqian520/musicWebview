var n=Object.defineProperty;var r=(a,t,e)=>t in a?n(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var i=(a,t,e)=>(r(a,typeof t!="symbol"?t+"":t,e),e);import{g as u,a as o}from"./request.694de692.js";import{r as s}from"./vendor.d4761c69.js";class d{constructor(){i(this,"ctx",null);i(this,"source",null);i(this,"audio",document.createElement("audio"));i(this,"fft",new Uint8Array(128));i(this,"analyser",null);i(this,"isPlay",s(!1));i(this,"music",s({}));i(this,"listDou",s([]));i(this,"listNet",s([]));i(this,"indexNet",s(0));i(this,"indexDou",s(0));i(this,"updateNetCb",null);i(this,"updateProgressCb",null);i(this,"order",s(1));i(this,"index",0);i(this,"listWant",[]);i(this,"isUserSlide",!1)}init(){this.ctx=new AudioContext,this.analyser=this.ctx.createAnalyser(),this.source=this.ctx.createMediaElementSource(this.audio),this.analyser.fftSize=256,this.source.connect(this.analyser).connect(this.ctx.destination),this.audio.ontimeupdate=()=>{this.updateNetCb&&this.music.value.platform=="net"&&this.updateNetCb(),this.updateProgressCb&&!this.isUserSlide&&this.updateProgressCb()};let t=this;this.audio.addEventListener("ended",this.next.bind(t))}async start(t,e){if(this.isPlay.value=!0,t.name==this.music.value.name){this.audio.play();return}this.ctx||this.init(),this.audio.pause(),this.music.value=t,this.index=e;let l;t.platform=="net"?(l=await u(t.id),this.indexNet.value=e):t.platform=="dou"&&(l=t.url,this.indexDou.value=e);let h=await o(l);this.audio.src=h,this.audio.play()}next(){if(this.listWant.length==0){let t=this.music.value.platform=="net"?this.listNet.value:this.listDou.value;this.order.value==0?(this.index=this.index<t.length-1?this.index+1:0,this.start(t[this.index],this.index)):this.order.value==1?(this.index=Math.floor(Math.random()*t.length-1),this.start(t[this.index],this.index)):this.order.value==2&&this.audio.play()}else this.start(this.listWant[0]),this.listWant.shift()}last(){let t=this.music.value.platform=="net"?this.listNet.value:this.listDou.value;this.index=this.index-1<0?0:this.index-1,this.start(t[this.index],this.index)}pause(){this.audio.pause(),this.isPlay.value=!1}resume(){console.log("resume"),this.audio.play(),this.isPlay.value=!0}}const p=new d;export{p};
